# Internationalization (i18n)

Using `next-intl` with flat key structure.

## Feature Structure

```
features/i18n/
├── messages/
│   ├── en.json         # English translations
│   └── es.json         # Spanish translations
├── routing.ts          # Locale routing configuration
├── request.ts          # Request-scoped i18n config
└── navigation.ts       # Locale-aware navigation helpers
```

---

## Configuration

### Routing
```typescript
// features/i18n/routing.ts
import { defineRouting } from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['es', 'en'],
  defaultLocale: 'es',
  localePrefix: 'as-needed'  // Only show prefix for non-default locale
});
```

### Request Config
```typescript
// features/i18n/request.ts
import { getRequestConfig } from 'next-intl/server';
import { hasLocale } from 'next-intl';
import { routing } from '@/features/i18n/routing';

export default getRequestConfig(async ({ requestLocale }) => {
  const requested = await requestLocale;
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale;

  return {
    locale,
    messages: (await import(`./messages/${locale}.json`)).default
  };
});
```

### Navigation Helpers
```typescript
// features/i18n/navigation.ts
import { createNavigation } from 'next-intl/navigation';
import { routing } from '@/features/i18n/routing';

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);
```

---

## Flat Key Structure

Keys are lowercase English sentences. **No dots, no nesting.**

```json
{
  "what do you need done?": "What do you need done?",
  "authentication required please sign in": "Authentication required. Please sign in.",
  "copyright": "© {year} Company Inc. All rights reserved."
}
```

### Why Flat Keys?
1. **Self-documenting** - Key tells you what the text says
2. **No namespace conflicts** - Dots break next-intl error system
3. **Easier search** - Find by English text
4. **Simpler maintenance** - No deep nesting

---

## Usage

### Server Components
```typescript
import { getTranslations } from 'next-intl/server'

export async function ServerComponent() {
  const t = await getTranslations()

  return (
    <div>
      <p>{t('what do you need done?')}</p>
      <p>{t('copyright', { year: new Date().getFullYear() })}</p>
    </div>
  )
}
```

### Client Components
```typescript
'use client'
import { useTranslations } from 'next-intl'

export function ClientComponent() {
  const t = useTranslations()

  return (
    <div>
      <p>{t('what do you need done?')}</p>
      <p>{t('copyright', { year: new Date().getFullYear() })}</p>
    </div>
  )
}
```

### Navigation
```typescript
// Use these instead of next/link and next/navigation
import { Link, useRouter } from '@/features/i18n/navigation'

// In components
<Link href="/agents">Go to agents</Link>

// Programmatic
const router = useRouter()
router.push('/agents')
```

---

## Adding Translations

1. Add key to `features/i18n/messages/en.json`
2. Add translation to `features/i18n/messages/es.json`
3. Use in components with `t('your new key')`

```json
// en.json
{
  "your new feature": "Your new feature"
}

// es.json
{
  "your new feature": "Tu nueva función"
}
```

---

## Rules

| Context | Function | Import From |
|---------|----------|-------------|
| Server Component | `getTranslations()` | `next-intl/server` |
| Client Component | `useTranslations()` | `next-intl` |
| Page/Layout | `setRequestLocale(locale)` | `next-intl/server` |
| Navigation | `Link`, `useRouter` | `@/features/i18n/navigation` |

### Key Rules
- Lowercase English text as keys
- No dots (`.`) in keys
- No nested objects
- Use `{variable}` for interpolation
